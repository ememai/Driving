{% load static custom_filters %}

<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
    <head>
        <!-- Core Meta Tags -->
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Iga amategeko y'umuhanda, witoze  ibibazo uzabazwa mu kizamini cya provisior, hamwe n' 250 College." />

        <title>{% block title %}Amategeko y'Umuhanda | Ikizamini cya Provisior{% endblock %} | IGAZETI.RW</title>
        <link rel="canonical" href="https://www.igazeti.rw" />
        <link rel="alternate" href="https://www.igazeti.rw" hreflang="rw" />
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

        <!-- Favicon & App Manifest -->
        <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}" />
        <link rel="icon" type="image/png" href="{% static 'img/logo.png' %}" />
        <link rel="manifest" href="{% static 'site.webmanifest' %}" />

        <!-- Theme Configuration -->
        <meta name="theme-color" content="#ffffff" />
        <meta name="msapplication-TileColor" content="#ffffff" />

        <!-- Open Graph Meta Tags (for social sharing) -->
        <meta property="og:title" content="Amategeko y'umuhanda ku rubuga IGAZETI.RW" />

        <meta property="og:description" content="Igana natwe amategeko y'umuhanda, ubone Provisior mu gihe gitoðŸªª"/>
        <meta property="og:image" content="https://www.igazeti.rw/static/img/logo.png" />
        <meta property="og:url" content="https://www.igazeti.rw" />
        <meta property="og:type" content="website" />

        <!-- Twitter Card Meta Tags -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content="Ikizamini cya Provisior - Amategeko y'Umuhanda" />
        <meta name="twitter:description" content="Witoze ikizamini cyakozwe, menya umuvuduko, rumoroki, makuzungu na byose ku kinyabiziga." />

        <meta name="twitter:image" content="https://www.igazeti.rw/static/img/logo.png" />

        <!-- Stylesheets -->

        {% block css_framework %}

        <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"></noscript>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" />

        {% endblock %}
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
        <link rel="stylesheet" href="{% static 'css/theme.css' %}" />
        <link rel="stylesheet" href="{% static 'css/main.css' %}" />
        <link rel="stylesheet" href="{% static 'css/login.css' %}" />        

            {% block extra_css %}
            <style>
                /* Loader spinner and text fade animation */
                .loader-spinner, .loader-text {
                    transition: opacity 0.5s cubic-bezier(0.4,0,0.2,1), visibility 0.5s;
                }
                .fade-out-loader {
                    opacity: 0 !important;
                    visibility: hidden !important;
                }
                .fade-in-loader {
                    opacity: 1 !important;
                    visibility: visible !important;
                }
                #main-content {
                    margin-top: 15px;
                    margin-bottom: 5rem;
                }
                .scroll-btn {
                    transition: opacity 0.4s ease;
                }
            </style>
            {% endblock %}
            {% if not user.is_authenticated %}
                <style>
                    .hours {
                        display: none;
                    }

                    main{
                        padding-top:40px;
                    }


                </style>

            {% endif %}

        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8155682167004021"
     crossorigin="anonymous"></script>
    </head>

    {% include "flash_message.html" %}

    <body class="d-flex flex-column min-vh-100 bg-theme text-theme gap-0">
        {% include "registration/login.html" %}
        <!-- Global Loader -->

            <div class="global-loader" id="global-loader" aria-hidden="true">
                <div class="spinner-border text-warning loader-spinner loading" role="status" style="width: 3rem; height: 3rem;"></div>
                <div class="loader-text fs-5 px-2 mt-2 fw-bold loading">Tegereza gato...</div>
                <!-- The spinner and loader-text will be hidden when try-again-btn is shown -->
                <button id="try-again-btn" class="btn rounded rounded-pill btn-theme mt-3 d-none" 
                onclick="window.location.reload()" style="transition: all 0.3s ease;">Refresh</button>
            </div>

            <style>
                .global-loader {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(0,0,0,0.5);
                    z-index: 2000;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    opacity: 0;
                    pointer-events: none;
                    transition: opacity 0.3s ease;
                }
                .global-loader.active {
                    opacity: 1;
                    pointer-events: auto;
                }
                .global-loader .loader-text {
                    color: #fff;
                    font-size: 1.2rem;
                    text-align: center;
                }

                @media (min-width: 768px) {
                    #sidebar {
                        margin-left: 60px;
                    }
                    
                    #main-content-wrapper {
                        margin-left: 60px;
                    }
                }

                main {
                    transition: margin-left 0.3s ease;
                }
            </style>
            {% comment %} {% if user.is_staff %}
                    <button id="test-loader-btn" class="btn btn-warning position-fixed" style="top: 80px; right: 20px; z-index: 20001;">Test Loader & Try Again</button>
                    <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        var btn = document.getElementById('test-loader-btn');
                        if (btn) {
                            btn.addEventListener('click', function() {
                                globalLoader.show();
                                setTimeout(function() {
                                    globalLoader.showTryAgain();
                                }, 1000); // Show Try Again after 11s
                            });
                        }
                    });
                    </script>
            {% endif %}  {% endcomment %}
        <!-- Status Icons -->
        <div class="status-icon checkmark-icon" id="success-indicator">
            <i class="bi bi-check-circle-fill"></i> <!-- Bootstrap checkmark icon -->
        </div>

        <div class="status-icon error-icon" id="error-indicator">
            <i class="bi bi-x-circle-fill"></i> <!-- Bootstrap X mark icon -->
        </div>
        <!-- Navigation -->
        {% block navbar %}
        {% include 'default-navbar.html' %}
        {% endblock %}

        <!-- Main Content -->
        <main class="flex-grow-1" id="main-content-wrapper">
            <div class="container" id="main-content">

                {% block content %}{% endblock %}
            </div>
        </main>

        {% if not request.user.is_authenticated %}
            <div class="d-flex justify-content-between py-0">
                <i class="fa-solid fa-truck-monster"></i>
                <i class="fa-solid fa-car "></i>
                <i class="fa-solid fa-bicycle "></i>
                <i class="fa-solid fa-bus "></i>
                
            </div>
        {% endif %}

        <!-- Footer -->
        {% comment %} <footer class="bg-theme text-theme py-4 mt-0 mx-0 border-top border-secondary">
            <div class="container-fluid text-center">
                <!-- Social Links -->
                <div class="d-flex flex-wrap justify-content-center align-items-center gap-4 mb-3">
                <a href="https://www.tiktok.com/@250college?is_from_webapp=1&sender_device=pc" target="_blank" class="text-decoration-none text-theme d-flex align-items-center gap-2 hover-opacity fs-6">
                    <i class="bi bi-tiktok"></i>
                    <span>TikTok</span>
                </a>
                <a href="https://youtube.com/@250drivingcollege?si=-uAEcoRDZDkyB3Go" target="_blank" class="text-decoration-none text-theme d-flex align-items-center gap-2 hover-opacity">
                    <i class="bi bi-youtube fs-5 text-danger"></i>
                    <span>Youtube Channel</span>
                </a>

            </div>
            <div class="d-flex flex-wrap justify-content-center align-items-center gap-4 mb-3">
                <a href="https://chat.whatsapp.com/JWaVSWktgBCKHNKr1TVAzg" target="_blank" class="text-decoration-none text-theme d-flex align-items-center gap-2 hover-opacity">
                    <i class="fa-solid fa-users fs-5 text-success"></i>
                    <span>WhatsApp Group</span>
                </a>
                <a href="https://https://whatsapp.com/channel/0029VawmHyN2UPBKKM3OJc20" target="_blank" class="text-decoration-none text-theme d-flex align-items-center gap-2 hover-opacity fs-6">
                    <i class="bi bi-broadcast-pin text-success"></i>
                    <span>WhatsApp Channel</span>
                </a>
               
            </div>

                <!-- Divider -->
                <hr class="border-secondary w-75 mx-auto opacity-25">

                <!-- Footer Info -->
                <div class="small text-center opacity-75">
                &copy; {% now "Y" %} <strong>IGAZETI.RW</strong> â€” All rights reserved.
                </div>
            </div>
        </footer>

        <style>
            .hover-opacity {
                transition: opacity 0.3s ease, transform 0.3s ease;
            }
            .hover-opacity:hover {
                opacity: 0.8;
                transform: translateY(-2px);
            }
            footer i {
                transition: transform 0.3s ease;
            }
            footer a:hover i {
                transform: scale(1.2);
            }
        </style> {% endcomment %}

        <!-- Logout Confirmation Modal -->
        {% include "logout_confirm.html" %}
        <!-- Core Scripts -->

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <script src="{% static "js/back-top.js" %}"></script>

        <!-- Global Loading System -->
        <!-- In base.html -->
        <script>
            // Enhanced global loader system
            const globalLoader = {
                element: document.getElementById('global-loader'),
                successIndicator: document.getElementById('success-indicator'),
                errorIndicator: document.getElementById('error-indicator'),
                flashMessages: document.getElementById('flash-messages'),
                tryAgainBtn: document.getElementById('try-again-btn'),
                loaderSpinner: document.querySelector('.loader-spinner'),
                loaderText: document.querySelector('.loader-text'),

                show: () => {
                    globalLoader.element.classList.add('active');
                    document.body.style.overflow = 'hidden';
                },

                hide: () => {
                    globalLoader.element.classList.remove('active');
                    document.body.style.overflow = '';
                },

                showSuccess: () => {
                    globalLoader.hide();
                    globalLoader.successIndicator.classList.add('show');
                    setTimeout(() => {
                        globalLoader.successIndicator.classList.remove('show');
                    }, 2000); // Show checkmark for 2 seconds
                },
                showError: () => {
                    globalLoader.hide();
                    globalLoader.errorIndicator.classList.add('show');
                    setTimeout(() => {
                        globalLoader.errorIndicator.classList.remove('show');
                    }, 2000);
                },
                showTryAgain: () => {
                    if (globalLoader.tryAgainBtn) {
                        globalLoader.tryAgainBtn.classList.remove('d-none');
                        
                        // Instantly hide spinner and text
                        document.querySelectorAll('.loader-spinner, .loader-text').forEach(el => {
                            el.classList.add('d-none');
                            el.classList.remove('fade-in-loader');
                            el.classList.remove('fade-out-loader');
                        });
                    }
                },
                hideTryAgain: () => {
                    if (globalLoader.tryAgainBtn) {
                        globalLoader.tryAgainBtn.classList.add('d-none');
                        // Animate fade in
                        document.querySelectorAll('.loader-spinner, .loader-text').forEach(el => {
                            el.classList.remove('d-none');
                            el.classList.remove('fade-out-loader');
                            // Force reflow for transition
                            void el.offsetWidth;
                            el.classList.add('fade-in-loader');
                        });
                    }
                }
            };

            // Show loader immediately on script load (before DOMContentLoaded)
            globalLoader.show();

            // Timeout for loader (10 seconds)
            let loaderTimeout = setTimeout(() => {
                globalLoader.showTryAgain();
            }, 30000);

            let xklName = `<div class="d-flex align-items-center">
                <i class="bi bi-car-front-fill text-warning fs-1"></i>
                <span class=""> 250 COLLEGE </span>
            <i class="bi bi-mortarboard text-success fs-1"> </i>
            </div>`;
            // Set the content of the element with id "kds"
            document.addEventListener('DOMContentLoaded', function() {
                const kdsElem = document.getElementById("kds");
                if (kdsElem) kdsElem.innerHTML = xklName;
            });

            // Auto-handle form submissions
            document.addEventListener('submit', function (e) {
                if (e.target.tagName.toLowerCase() === 'form') {
                    const form = e.target;
                    globalLoader.show();
                    globalLoader.hideTryAgain();
                    clearTimeout(loaderTimeout);
                    loaderTimeout = setTimeout(() => {
                        globalLoader.showTryAgain();
                        globalLoader.hide();
                    }, 10000);

                    // Handle AJAX form submissions
                    if (form.dataset.ajax === 'true') {
                        e.preventDefault();
                        const formData = new FormData(form);

                        fetch(form.action, {
                            method: form.method,
                            body: formData,
                            headers: {
                                'X-Requested-With': 'XMLHttpRequest',
                                'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
                            },
                            credentials: 'same-origin'
                        })
                            .then(response => {
                                if (!response.ok) throw new Error(response.statusText);
                                return response.json();
                            })
                            .then(data => {
                                if (data.status === 'success') {
                                    globalLoader.showSuccess();
                                    if (data.redirect) {
                                        setTimeout(() => {
                                            window.location.href = data.redirect;
                                        }, 2000); // Redirect after 2 seconds
                                    }
                                } else {
                                    globalLoader.showError();
                                }
                            })
                            .catch(error => {
                                globalLoader.showError();
                                console.error('Error:', error);
                            });
                    }
                }
            });

            // Hide loader after DOM is ready
            document.addEventListener('DOMContentLoaded', () => {
                globalLoader.hide();
                globalLoader.hideTryAgain();
                clearTimeout(loaderTimeout);

                // Check for success messages in flash messages
                const successMessage = document.querySelector('.alert-success');
                const errorMessage = document.querySelector('.alert-danger');

                if (successMessage) {
                    globalLoader.showSuccess();
                } else if (errorMessage) {
                    globalLoader.showError();
                }

                // Initialize time slots
                document.querySelectorAll(".time-slot").forEach(slot => {
                    slot.addEventListener("click", (e) => {
                        e.preventDefault();
                        document.querySelectorAll(".time-slot").forEach(s => s.classList.remove("active"));
                        slot.classList.add("active");
                    });
                });
            });

            // Handle navigation events
            window.addEventListener('beforeunload', () => {
                globalLoader.show();
                globalLoader.hideTryAgain();
                clearTimeout(loaderTimeout);
                loaderTimeout = setTimeout(() => {
                    globalLoader.showTryAgain();
                }, 10000);
            });
            window.addEventListener('unload', () => globalLoader.hide());
        </script>
        <script type="application/ld+json">
            {
            "@context": "https://schema.org",
            "@type": "DrivingSchool",
            "name": "IGAZETI.RW",
            "description": "IGA amategeko y'umuhanda ukosore ibibazo uzabazwa mu kizamini cya provisior mu buryo bworoshye.",
            "url": "https://www.igazeti.rw",
            "address": {
                "@type": "PostalAddress",
                "addressLocality": "Kigali",
                "addressCountry": "RW"
            }
            }
        </script>

            <!-- Modals -->

            {% block extra_js %}

        <!-- Page-specific Scripts -->
            {% endblock %}
     <!-- Middle Right Scroll Buttons with Spacing -->
        <div id="scroll-buttons" class="position-fixed top-50 end-0 translate-middle-y  p-0 d-flex flex-column gap-2 align-items-end" style="z-index: 1050;">
            <button id="scrollTopBtn" type="button"
                class="btn btn-outline-theme p-1 rounded-circle shadow-sm scroll-btn fade bounce"
                data-bs-toggle="tooltip" data-bs-placement="left" title="Back to Top"
                style="width: 30px; height: 30px; font-size: 14px; opacity: 0;">
                <i class="fa-solid fa-arrow-up"></i>
            </button>

            <button id="scrollBottomBtn" type="button"
                class="btn btn-outline-theme p-1 rounded-circle shadow-sm scroll-btn bounce"
                data-bs-toggle="tooltip" data-bs-placement="left" title="Go to Bottom"
                style="width: 30px; height: 30px; font-size: 14px;">
                <i class="fa-solid fa-arrow-down"></i>
            </button>

           <button
               class="btn btn-outline-secondary my-4 p-0 rounded-circle shadow-sm themeToggle scroll-btn"
               type="button"
               data-bs-toggle="tooltip"
               data-bs-placement="left"
               style="width: 40px; height: 40px; font-size: 18px;"
           >
               <i class="themeIcon bi bi-moon fs-4"></i>
               <span class="visually-hidden">Toggle dark mode</span>
           </button>

        </div>

        {% comment %} right Theme toggler {% endcomment %}

        
        {% if user.is_authenticated %}
            <div class="d-flex flex-column gap-4 d-lg-none fixed-bottom bg-theme text-theme shadow-md  border-top py-2" style="border-radius: 0 0 0.5rem 0.5rem; width: 100%; z-index: 1050;">
                <div class="d-flex justify-content-around">
                    <a
                    class="nav-link d-flex flex-column align-items-center "
                    href="{% url 'home' %}"
                    >
                    <i class="bi bi-house-door-fill {% if request.path == '/' %}bg-secondary rounded px-2{% endif %}"></i>
                    <em class="nav-text">Ahabanza</em>
                    </a>
                    <a
                    class="nav-link d-flex flex-column align-items-center"
                    href="{% url 'courses' %}"
                    >
                    <i class="bi bi-book-fill {% if request.path == '/amasomo/' %}bg-secondary rounded px-2{% endif %}"></i>
                    <em class="nav-text">Amasomo</em>
                    </a>
                    <a
                    class="nav-link d-flex flex-column align-items-center"
                    href="{% url 'contact' %}"
                    >
                    <i class="bi bi-envelope-fill {% if request.path == '/contact/' %}bg-secondary rounded px-2{% endif %}"></i>
                    <span class="nav-text">Twandikire</span>
                    </a>
                    <a
                    class="nav-link d-flex flex-column align-items-center"
                    href="{% url 'weekly_exams' %}"
                    >
                    <i class="bi bi-calendar-week {% if request.path == '/ibizamini-byicyumweru/' %}bg-secondary rounded px-2{% endif %}"></i>
                    <span class="nav-text">Icyumweru</span>
                    </a>
                </div>
            </div>

            {% comment %} desktop sidebar {% endcomment %}

            <div id="desktop-sidebar" class="d-none d-lg-block fixed-top bg-theme text-theme shadow-md border-end py-4" style="width: 250px; height: 100vh; z-index: 1050; transition: width 0.3s; overflow: hidden; top: 0; left: 0;">
                <div class="d-flex flex-column justify-content-start align-items-center gap-4 h-100 ">
                    <!-- Collapse/Expand Button -->
                    <button id="sidebarToggle" class="btn btn-outline-secondary mb-2 align-self-end me-3" style="z-index:1100;" data-bs-toggle="tooltip" data-bs-placement="right" title="Toggle Sidebar">
                        <i class="fa fa-angle-double-left"></i>
                    </button>
                    <a href="{% url 'profile' %}" class="nav-link d-flex flex-column align-items-center mb-1" data-bs-toggle="tooltip" data-bs-placement="right" title="Profile">
                        <div class="avatar-circle mx-2" style="width: 50px; height: 50px; font-size: 24px; line-height: 50px; background-color: #312e13; color: #fff; text-align: center; border-radius: 50%;">
                          {{ request.user.name|slice:":2"|upper }}
                        </div>
                    </a>
                    <div class="border-top border-secondary w-75"></div>
                    <div class="overflow-auto align-items-center gap-3 d-flex flex-column flex-grow-1 w-100" style="max-height: 100vh;">
                        <a class="nav-link d-flex gap-2 align-items-center sidebar-link" href="{% url 'home' %}" data-bs-toggle="tooltip" data-bs-placement="right" title="Ahabanza">
                            <i class="bi bi-house-door-fill fs-4"></i>
                            <em class="nav-text">Ahabanza</em>
                        </a>
                        <a class="nav-link d-flex gap-2 align-items-center sidebar-link" href="{% url 'courses' %}" data-bs-toggle="tooltip" data-bs-placement="right" title="Amasomo">
                            <i class="bi bi-book-fill fs-4"></i>
                            <em class="nav-text">Amasomo</em>
                        </a>
                        <a class="nav-link d-flex gap-2 align-items-center sidebar-link" href="{% url 'contact' %}" data-bs-toggle="tooltip" data-bs-placement="right" title="Twandikire">
                            <i class="bi bi-envelope-fill fs-4"></i>
                            <span class="nav-text">Twandikire</span>
                        </a>
                        <a class="nav-link d-flex gap-2 align-items-center sidebar-link" href="{% url 'weekly_exams' %}" data-bs-toggle="tooltip" data-bs-placement="right" title="Icyumweru">
                            <i class="bi bi-calendar-week fs-4"></i>
                            <span class="nav-text">Icyumweru</span>
                        </a>
                        {% if user.is_staff %}
                        <a class="nav-link d-flex gap-2 align-items-center sidebar-link" href="{% url 'admin:index' %}" data-bs-toggle="tooltip" data-bs-placement="right" title="Admin">
                            <i class="bi bi-speedometer2"></i>
                            <span class="nav-text">Admin</span>
                        </a>
                        <a class="nav-link d-flex gap-2 align-items-center sidebar-link" href="{% url 'create_exam' %}" data-bs-toggle="tooltip" data-bs-placement="right" title="Create Exam">
                            <i class="bi bi-plus-circle-fill fs-4"></i>
                            <span class="nav-text">Create Exam</span>
                        </a>
                        <a class="nav-link d-flex gap-2 align-items-center sidebar-link" href="{% url 'auto_schedule_exams' %}" data-bs-toggle="tooltip" data-bs-placement="right" title="Auto Schedule">
                            <i class="bi bi-calendar-check-fill fs-4"></i>
                            <span class="nav-text">Auto Schedule</span>
                        </a>
                        {% endif %}
                        <div class="border-top border-secondary w-75"></div>
                        <button class="nav-link d-flex gap-2 align-items-center" type="button" data-bs-toggle="modal" data-bs-target="#logoutModal" data-bs-toggle="tooltip" data-bs-placement="right" title="Sohoka">
                            <i class="bi bi-box-arrow-right fs-3"></i>
                            {% comment %} <span>Sohoka</span> {% endcomment %}
                        </button>
                    </div>
                </div>
            </div>
        <script>
        // Sidebar collapse/expand
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('desktop-sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const otherContent = document.querySelector('main');
            const navbar = document.querySelector('nav');
            let collapsed = true; // Collapsed by default

            // Collapse sidebar by default on load
            sidebar.style.width = '60px';
            sidebar.querySelectorAll('.nav-text').forEach(e => e.style.display = 'none');
            sidebarToggle.innerHTML = '<i class="fa fa-angle-double-right"></i>';
            sidebarToggle.addEventListener('click', function() {
                collapsed = !collapsed;
                if (collapsed) {
                    sidebar.style.width = '60px';
                    if (otherContent) otherContent.style.marginLeft = '60px';
                    
                    sidebar.querySelectorAll('.nav-text').forEach(e => e.style.display = 'none');
                    sidebarToggle.innerHTML = '<i class="fa fa-angle-double-right"></i>';
                } else {
                    sidebar.style.width = '250px';
                    if (otherContent) otherContent.style.marginLeft = '250px';
                    sidebar.querySelectorAll('.nav-text').forEach(e => e.style.display = '');
                    sidebarToggle.innerHTML = '<i class="fa fa-angle-double-left"></i>';
                }
            });

            // Enable Bootstrap tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.forEach(function (tooltipTriggerEl) {
                new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // Active link highlighting based on current path
            const links = sidebar.querySelectorAll('.sidebar-link');
            links.forEach(link => {
                if (link.getAttribute('href') === window.location.pathname) {
                    link.classList.add('active');
                    link.querySelector('i').classList.add('bg-secondary', 'rounded', 'px-2');
                } else {
                    link.classList.remove('active');
                    link.querySelector('i').classList.remove('bg-secondary', 'rounded', 'px-2');
                }
            });
        });
        </script>

        {% endif %}

       <!-- Unverified Subscription Modal -->
        <div class="modal fade" id="unverifiedModal" tabindex="-1"          aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-theme text-theme">
                    <h6 class="modal-title fw-bold">Ubwishyu bwawe bwemejwe</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <a href="{% url 'activate_subscription' %}" class="btn rounded-pill shadow-lg" 
                    style="background-color: rgba(var(--text-rgb), 1); 
                        color: rgba(var(--background-rgb), 1);">Fungura ifatabuzi</a>
                </div>
                </div>
            </div>
        </div>
        
        <script>
            let modalShown = false; // Track if modal has been shown

            function checkUnverified() {
                const currentPath = window.location.pathname;
                const activateUrls = [
                    "{% url 'activate_subscription' %}",
                    "{% url 'payment' %}",
                    "{% url 'subscription' %}",
                ];

                if (activateUrls.includes(currentPath)) return;

                fetch("{% url 'check_unverified' %}", {
                    headers: {
                        "X-Requested-With": "XMLHttpRequest"
                    }
                })
                .then(response => {
                    if (!response.ok) throw new Error("HTTP " + response.status);
                    return response.json();
                })
                .then(data => {
                    if (data.unverified && !modalShown) {
                        const modal = new bootstrap.Modal(document.getElementById("unverifiedModal"), {
                            backdrop: true,   // allow closing by clicking outside
                            keyboard: true    // allow closing with ESC
                        });
                        modal.show();
                        modalShown = true;
                    }
                })
                .catch(err => console.error("Error checking subscription:", err));
            }

            document.addEventListener("DOMContentLoaded", function() {
                checkUnverified();
                // Poll every 10 seconds for more real-time feel
                setInterval(checkUnverified, 10000);
            });
        </script>

        <script>
            const scrollTopBtn = document.getElementById('scrollTopBtn');
            const scrollBottomBtn = document.getElementById('scrollBottomBtn');
            const scrollButtons = document.getElementById('scroll-buttons');
            

            // Scroll behavior
            scrollTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
            scrollBottomBtn.addEventListener('click', () => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }));

            // Show scrollTopBtn only after some scroll
            window.addEventListener('scroll', () => {
                if (window.scrollY > 100) {
                    scrollTopBtn.style.opacity = '1';
                } else {
                    scrollTopBtn.style.opacity = '0';
                }
                showButtonsTemporarily(); // Reset timer on scroll
            });

            // Auto-hide after inactivity
            let hideTimer;
            function showButtonsTemporarily() {
                scrollButtons.classList.add('fade-in');
                scrollButtons.classList.remove('fade-out');

                clearTimeout(hideTimer);
                hideTimer = setTimeout(() => {
                    scrollButtons.classList.add('fade-out');
                    scrollButtons.classList.remove('fade-in');
                }, 3000); // Hide after 1 seconds
            }

            // Trigger on any mouse or scroll interaction
            ['mousemove', 'scroll', 'keydown', 'touchstart'].forEach(evt => {
                window.addEventListener(evt, showButtonsTemporarily);
            });

            // Initial state
            scrollButtons.classList.add('fade-in');
        </script>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const currentPath = window.location.pathname;

                if (currentPath === "{% url "login" %}") {
                    const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                    loginModal.show();
                }
            });
        </script>
        <script src="{% static 'js/theme-switcher.js' %}"></script>
    </body>

</html>