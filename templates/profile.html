{% extends 'base.html' %}
{% load static %}

{% block title %}{{request.user.name}} - Kigali Driving School{% endblock %}

{% block content %}
<style>
  .hours {
    display: None;
  }
  {% comment %} ul{
    transition: all 0.4s ease-in-out;
  } {% endcomment %}

  .tab-pane{
    transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
    opacity: 0;
    transform:scale(50%);
    position: absolute;
    width: 100%;
  }

  .tab-pane.show.active {
    opacity: 1;
    transform: translateX(0);
    position: relative;
  }

  
  #profileTabsContent {
    position: relative;
    overflow: hidden;
    min-height: 200px; /* Adjust based on your content */
  }
</style>

<div class="profile-container border">

  <!-- Profile Header -->
  <div class="card mb-4">
    <div class="card-body d-flex gap-3 align-items-center">
      <i class="bi bi-person-circle fs-1"></i>
      <div>
        <h3>{{ user.name }}</h3>
        <p>
          {% if user.email %}Email: {{ user.email }} {% endif %}
          {% if user.phone_number %} Phone: {{ user.phone_number }}{% endif %}
        </p>
      </div>
      {% comment %} <div class="ms-auto">
        <a href="#" class="btn btn-dark-yellow">Edit Profile</a>
      </div> {% endcomment %}
    </div>
  </div>
  <!-- Tabbed Sections for Exam History, Recent Activity, and Notifications -->
  <ul class="nav nav-tabs d-flex flex-nowrap mb-0" id="profileTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active fw-bold" id="exams-tab" data-bs-toggle="tab" data-bs-target="#exams" type="button"
        role="tab" aria-controls="exams" aria-selected="true">Ibizamini wakoze({{exam_history.count}})</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link fw-bold" id="activity-tab" data-bs-toggle="tab" data-bs-target="#activity" type="button"
        role="tab" aria-controls="activity" aria-selected="false">Ibizamini watsinze({{pass_exams.count}})</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link fw-bold" id="notifications-tab" data-bs-toggle="tab" data-bs-target="#notifications"
        type="button" role="tab" aria-controls="notifications" aria-selected="false">Ibizamini
        watsinzwe({{fail_exams.count}})</button>
    </li>
  </ul>
  <div class="tab-content" id="profileTabsContent">
    <!-- Exam History Tab -->
    <div class="tab-pane fade show active" id="exams" role="tabpanel" aria-labelledby="exams-tab">
      {% if exam_history %}
      <ul class="list-group">
        {% for exam in exam_history %}
        <li class="list-group-item pb-5">
          
          <h2 class="text-decoration-underline text-muted">Icya {{ forloop.counter }}</h2>
          <a href="{% url "exam_results" exam.id %}" class="text-decoration-none text-theme">
          <ul class="">
            <li>
              <h5>Wagikoze: {{ exam.completed_at|date:"d/m/Y H:i" }}</h5>
            </li>
            <li>
              <h5>Amanota wagize: {{ exam.score }} / {{exam.exam.total_score}}</h5>
            </li>

            <li>
              <h5>Ijanisha: {{ exam.percent_score }}%</h5>
            </li>
            <li>
              <h5>Igihe wakorejeshe: Iminota({{ exam.time_taken }})</h5>
            </li>
            <a href="{% url "exam_results" exam.id %}" class="btn btn-outline-info">
              <i class="bi bi-eye"></i>Reba cyose</a>
          </ul>
        </a>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p>Nta kizamini urakora.</p>
      {% endif %}
    </div>
    <!-- Recent Activity Tab -->
    <div class="tab-pane fade" id="activity" role="tabpanel" aria-labelledby="activity-tab">
      {% if pass_exams %}
      <ul class="list-group">

        {% for exam in pass_exams %}
        <li class="list-group-item pb-5">
         <h2 class="text-decoration-underline text-muted">Icya {{ forloop.counter }}</h2>
          <a href="{% url "exam_results" exam.id %}" class="text-decoration-none text-theme">
          <ul class="">
            <li>
              <h5>Wagikoze: {{ exam.completed_at|date:"d/m/Y H:i" }}</h5>
            </li>
            <li>
              <h5>Amanota wagize: {{ exam.score }} / {{exam.exam.total_score}}</h5>
            </li>

            <li>
              <h5>Ijanisha: {{ exam.percent_score }}%</h5>
            </li>
            <li>
              <h5>Igihe wakorejeshe: Iminota({{ exam.time_taken }})</h5>
            </li>
            <a href="{% url "exam_results" exam.id %}" class="btn btn-outline-info">
              <i class="bi bi-eye"></i>Reba cyose</a>
          </ul>
        </a>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p>Ntakizamini uratsinda.</p>
      {% endif %}
    </div>
    <!-- Notifications Tab -->
    <div class="tab-pane fade" id="notifications" role="tabpanel" aria-labelledby="notifications-tab">
      {% if fail_exams %}
      <ul class="list-group" id="notificationList">
        {% for exam in fail_exams %}
        <li class="list-group-item pb-5">
          <h2 class="text-decoration-underline text-muted">Icya {{ forloop.counter }}</h2>
          <a href="{% url "exam_results" exam.id %}" class="text-decoration-none text-theme">
          <ul class="">
            <li>
              <h5>Wagikoze: {{ exam.completed_at|date:"d/m/Y H:i" }}</h5>
            </li>
            <li>
              <h5>Amanota wagize: {{ exam.score }} / {{exam.exam.total_score}}</h5>
            </li>

            <li>
              <h5>Ijanisha: {{ exam.percent_score }}%</h5>
            </li>
            <li>
              <h5>Igihe wakorejeshe: Iminota({{ exam.time_taken }})</h5>
            </li>
            <a href="{% url "exam_results" exam.id %}" class="btn btn-outline-info">
              <i class="bi bi-eye"></i>Reba cyose</a>
          </ul>
        </a>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p>Ntakizamini uratsindwa.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const tabs = ['exams', 'activity', 'notifications'];
    const tabButtons = tabs.map(id => document.getElementById(`${id}-tab`));
    const tabContent = document.getElementById('profileTabsContent');

    let startX = 0;

    tabContent.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
    });

    tabContent.addEventListener('touchend', (e) => {
      const endX = e.changedTouches[0].clientX;
      const diff = startX - endX;

      if (Math.abs(diff) > 50) {
        let activeIndex = tabButtons.findIndex(btn => btn.classList.contains('active'));
        let nextIndex = diff > 0 ? activeIndex + 1 : activeIndex - 1;

        if (nextIndex >= 0 && nextIndex < tabButtons.length) {
          const direction = diff > 0 ? 'left' : 'right';
          animateTabSwitch(tabButtons[activeIndex], tabButtons[nextIndex], direction);
        }
      }
    });

    function animateTabSwitch(currentBtn, nextBtn, direction) {
      const currentPane = document.querySelector(currentBtn.dataset.bsTarget);
      const nextPane = document.querySelector(nextBtn.dataset.bsTarget);

      // Remove active from button
      currentBtn.classList.remove('active');
      nextBtn.classList.add('active');

      // Animate out current pane
      currentPane.classList.remove('show', 'active');
      currentPane.classList.add(direction === 'left' ? 'slide-left' : 'slide-right');

      // Prepare next pane
      nextPane.classList.add('active', 'show');
      nextPane.classList.remove('slide-left', 'slide-right');
    }
  });
</script>


{% endblock %}