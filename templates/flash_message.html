{% if messages %}
<div id="flash-messages" class="flash-popup-container">
  {% for message in messages %}
  <div
    class="flash-popup alert alert-{{ message.tags }} alert-dismissible fade show"
    role="alert"
  >
    <span class="fw-semibold">{{ message|safe }}</span>

    {% comment %} show progress bar 
    <div class="progress flash-progress mt-2 mb-0" style="height: 4px">
      <div
      class="progress-bar bg-light flash-progress-bar"
      role="progressbar"
      style="width: 100%"
      aria-valuenow="100"
      aria-valuemin="0"
      aria-valuemax="100"
      ></div>
    </div>
    {% endcomment %}
  </div>
  {% endfor %}
</div>
<style>
  .flash-popup-container {
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    z-index: 12000;
    width: 80vw;
    max-width: 360px;
    pointer-events: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 10px;
    padding: 0 10px;
  }

  @media (min-width: 576px) {
    .flash-popup-container {
      width: auto;
    }
  }

  .flash-popup {
    min-width: 280px;
    max-width: 420px;
    margin-bottom: 10px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.18);
    animation: slideDownFade 0.5s cubic-bezier(0.4, 1.6, 0.6, 1) both;
    pointer-events: auto;
    color: #fff !important;
    font-weight: 500;
  }
  .flash-popup.alert-success {
    background: #28a745 !important;
    border-color: #28a745 !important;
  }
  .flash-popup.alert-error,
  .flash-popup.alert-danger {
    background: #dc3545 !important;
    border-color: #dc3545 !important;
  }

  .flash-popup.alert-warning {
    background: #ffc107 !important;
    border-color: #ffc107 !important;
    color: #212529 !important;
  }

  .flash-popup.alert-info {
    background: #17a2b8 !important;
    border-color: #17a2b8 !important;
  }

  @keyframes slideDownFade {
    from {
      opacity: 0;
      transform: translateY(-40px) scale(0.98);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
</style>
<script>
  // Auto-dismiss after 5 seconds, animate progress bar
  document.addEventListener("DOMContentLoaded", function () {
    var duration = 5000;
    {% comment %} document.querySelectorAll(".flash-popup").forEach(function (el) {
      var bar = el.querySelector(".flash-progress-bar");
      if (bar) {
        bar.style.transition = `width ${duration}ms linear`;
        setTimeout(function () {
          bar.style.width = "0%";
        }, 50);
      }
    }); {% endcomment %}
    setTimeout(function () {
      document.querySelectorAll(".flash-popup").forEach(function (el) {
        if (el.classList.contains("show")) {
          el.classList.remove("show");
          el.classList.add("fade");
          setTimeout(function () {
            el.remove();
          }, 400);
        }
      });
    }, duration);

    // close on slide left or right swipe
    let startX = 0;
    document.querySelectorAll(".flash-popup").forEach(function (el) {
      el.addEventListener("touchstart", function (e) {
        startX = e.touches[0].clientX;
      });
      el.addEventListener("touchend", function (e) {
        let endX = e.changedTouches[0].clientX;
        let diffX = endX - startX;
        if (Math.abs(diffX) > 50) {
          el.classList.remove("show");
          el.classList.add("fade");
          setTimeout(function () {
            el.remove();
          }, 400);
        }
      });
    });
  });
</script>
{% endif %}
